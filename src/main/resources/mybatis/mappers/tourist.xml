<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="mapper.tourist">
  	
  	<!-- 관광지 api db에 저장용 -->
  	<insert id="touristadd">
		<foreach collection="list" open="DECLARE BEGIN" close="; END;" separator=";" item="pvo">		
			insert into P_tourist (alltag, label, label2, title, address, tag, introduction, imgpath, contentsid, phoneno, latitude, longitude)
			values (#{pvo.alltag, jdbcType=VARCHAR}, #{pvo.label, jdbcType=VARCHAR}, #{pvo.label2, jdbcType=VARCHAR}, #{pvo.title, jdbcType=VARCHAR}, #{pvo.address, jdbcType=VARCHAR}, #{pvo.tag, jdbcType=VARCHAR}, #{pvo.introduction, jdbcType=VARCHAR}, #{pvo.imgpath, jdbcType=VARCHAR}, #{pvo.contentsid, jdbcType=VARCHAR}, #{pvo.phoneno, jdbcType=VARCHAR}, #{pvo.latitude, jdbcType=VARCHAR}, #{pvo.longitude, jdbcType=VARCHAR})
		</foreach>
	</insert>
	
	<!-- 제주도 여행지 총 개수 -->
	<select id="getTotalRowCount" parameterType="kr.co.intrip.tourist.dto.PagingDTO" resultType="int">
		<![CDATA[
			SELECT count(*)
			FROM P_TOURIST
			WHERE label LIKE '관광지' AND ALLTAG  NOT LIKE '%전시%'
		]]>
	</select>
	
	<!-- 제주도 여행지 페이지 리스트  -->
	<select id="jejutourist" resultType="kr.co.intrip.tourist.dto.ApiDTO" parameterType="kr.co.intrip.tourist.dto.PagingDTO">
		<![CDATA[
			select *
   			 from (
        	select pt.*, row_number() over(order by label desc) as rNum
        	from P_TOURIST pt 
        	WHERE label LIKE '관광지' AND ALLTAG  NOT LIKE '%전시%'
        	) mb
   		 	where rNum between #{firstRow} and #{lastRow}		
		]]>
	</select>
	
	<!-- 제주도 축제 총 개수 -->
	<select id="getTotalRowCount2" parameterType="kr.co.intrip.tourist.dto.PagingDTO" resultType="int">
		<![CDATA[
			SELECT count(*)
			FROM P_TOURIST
			WHERE label LIKE '%축제%'
		]]>
	</select>
	
	<!-- 제주도 축제 페이지 리스트  -->
	<select id="jejufestival" resultType="kr.co.intrip.tourist.dto.ApiDTO" parameterType="kr.co.intrip.tourist.dto.PagingDTO">
		<![CDATA[
			select *
   			 from (
        	select pt.*, row_number() over(order by label desc) as rNum
        	from P_TOURIST pt 
        	WHERE label LIKE '%축제%'
        	) mb
   		 	where rNum between #{firstRow} and #{lastRow}		
		]]>
	</select>
	
	<!-- 제주도 전시관 총 개수 -->
	<select id="getTotalRowCount3" parameterType="kr.co.intrip.tourist.dto.PagingDTO" resultType="int">
		<![CDATA[
			SELECT count(*)
			FROM P_TOURIST
			WHERE alltag LIKE '%전시%' AND label LIKE '관광지'
		]]>
	</select>
	
	<!-- 제주도 전시관 페이지 리스트  -->
	<select id="jejuexhibition" resultType="kr.co.intrip.tourist.dto.ApiDTO" parameterType="kr.co.intrip.tourist.dto.PagingDTO">
		<![CDATA[
			select *
   			 from (
        	select pt.*, row_number() over(order by label desc) as rNum
        	from P_TOURIST pt 
        	WHERE alltag LIKE '%전시%' AND label LIKE '관광지'
        	) mb
   		 	where rNum between #{firstRow} and #{lastRow}		
		]]>
	</select>	
	
	<!-- 제주도 통합 상세페이지  -->
	<select id="jejudetail" resultType="kr.co.intrip.tourist.dto.ApiDTO" parameterType="String">
		<![CDATA[
			SELECT * FROM P_TOURIST 
			WHERE contentsid = #{contentsid,jdbcType=VARCHAR}
		]]>
	</select>
	
	<!-- 제주도 통합 상세페이지 조회수 증가  -->
	<update id="viewcount">
		<![CDATA[
			UPDATE P_TOURIST
			SET viewcount = viewcount + 1 
			WHERE contentsid = #{contentsid}
		]]>
	</update>
	
	<!-- 제주도 여행지 조회순 페이지 리스트  -->
	<select id="jejutourist_lookupSort" resultType="kr.co.intrip.tourist.dto.ApiDTO" parameterType="kr.co.intrip.tourist.dto.PagingDTO">
		<![CDATA[
			select *
   			 from (
        	select pt.*, row_number() over(order by viewcount desc) as rNum
        	from P_TOURIST pt 
        	WHERE label LIKE '관광지' AND ALLTAG  NOT LIKE '%전시%'
        	ORDER by viewcount desc
        	) mb
   		 	where rNum between #{firstRow} and #{lastRow}
   		 	ORDER by viewcount desc		  		 	
		]]>
	</select>	
	
	<!-- 제주도 축제 조회순 페이지 리스트  -->
	<select id="jejufestival_lookupSort" resultType="kr.co.intrip.tourist.dto.ApiDTO" parameterType="kr.co.intrip.tourist.dto.PagingDTO">
		<![CDATA[
			select *
   			 from (
        	select pt.*, row_number() over(order by viewcount desc) as rNum
        	from P_TOURIST pt 
        	WHERE label LIKE '%축제%'
        	ORDER by viewcount desc
        	) mb
   		 	where rNum between #{firstRow} and #{lastRow}	
   		 	ORDER by viewcount desc
		]]>
	</select>	
	
	<!-- 제주도 전시관 조회순 페이지 리스트  -->
	<select id="jejuexhibition_lookupSort" resultType="kr.co.intrip.tourist.dto.ApiDTO" parameterType="kr.co.intrip.tourist.dto.PagingDTO">
		<![CDATA[
			select *
   			 from (
        	select pt.*, row_number() over(order by viewcount desc) as rNum
        	from P_TOURIST pt 
        	WHERE alltag LIKE '%전시%' AND label LIKE '관광지'
        	ORDER by viewcount desc
        	) mb
   		 	where rNum between #{firstRow} and #{lastRow}	
   		 	ORDER by viewcount desc
		]]>
	</select>

	<!-- 제주도 댓글 조회 -->
   	<select id="jejuCommentselect" resultType="kr.co.intrip.tourist.dto.JejuCommentDTO">
   		<![CDATA[
	   		select *
	   		from P_JEJU_COMMENT
	   		where CONTENTSID = #{contentsid}
	   		order by com_date desc
   		]]>
   	</select>
   	
   	<!-- 제주도 댓글 작성 -->
	<insert id="jejuWriteReply">
			<selectKey keyProperty="com_num" order="BEFORE" resultType="int">
				select com_num.nextval from dual
			</selectKey>
		   	insert into P_JEJU_COMMENT(COM_NUM, ID, contentsid, COM_CONTENT)
		  	values( #{com_num}, #{id}, #{contentsid}, #{com_content})
	</insert>
	
	<!-- 제주도 댓글 수정 -->
	<update id="jejuupdateReply" parameterType="kr.co.intrip.tourist.dto.JejuCommentDTO">
		<![CDATA[
		   	update P_JEJU_COMMENT 
		   	set COM_CONTENT = #{com_content}
		   	where com_num = #{com_num}
	   	]]>
	</update>
	   	
	<!-- 제주도 댓글 삭제 -->
	<delete id="jejudeleteReply" parameterType="kr.co.intrip.tourist.dto.JejuCommentDTO">
		<![CDATA[
		   	delete
		   	from P_JEJU_COMMENT 
		   	where com_num = #{com_num}
		]]>
	</delete>
	
	<!-- 제주도 선택된 댓글 조회 -->
	<select id="jejuselectReply" resultType="kr.co.intrip.tourist.dto.JejuCommentDTO">
		<![CDATA[
			select *
			from P_JEJU_COMMENT
			where com_num = #{com_num}
		]]>
	</select>
 </mapper>